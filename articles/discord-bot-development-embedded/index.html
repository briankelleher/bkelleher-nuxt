<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Brian Kelleher</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" name="format-detection" content="telephone=no"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/d742747.js" as="script"><link rel="preload" href="/_nuxt/900b283.js" as="script"><link rel="preload" href="/_nuxt/87eb4cc.js" as="script"><link rel="preload" href="/_nuxt/eb224da.js" as="script"><link rel="preload" href="/_nuxt/381879a.js" as="script"><link rel="preload" href="/_nuxt/4e74c3e.js" as="script"><style data-vue-ssr-id="b13bd09c:0 b13bd09c:1 517a8dd7:0 fa7ff0ca:0 7783a668:0 166b59b9:0 2f9548d1:0 d64adc92:0">@import url(https://fonts.googleapis.com/css2?family=Archivo+Narrow:wght@400;700&family=Merriweather:ital,wght@0,300;0,700;1,300&display=swap);.dark-btn{cursor:pointer;text-decoration:underline;color:#00f}html.dark,html.dark body{background-color:#15202b;color:#fff}html.dark body a,html.dark body a:visited{color:#fff}html.dark body .post .post-tags a{color:#000}html.dark body .article-row .article-read-more,html.dark body .article-row .article-title-link,html.dark body .post .post-tags a:hover{color:#fff}*{font-family:Merriweather,serif}html{background-color:#f1f1f1}h1,h2,h3,h4,h5,h6{font-family:"Archivo Narrow",sans-serif;font-weight:700}h1,h2{font-size:40px}h3{font-size:30px}.nuxt-content-container h3{font-size:48px}body{margin:0}.contain{max-width:1070px;margin:0 auto;padding:0 32px}.page{margin-top:24px}.page.contain{max-width:1070px;margin:0 auto}.row{display:flex;grid-column-gap:20px;-moz-column-gap:20px;column-gap:20px}.row .col{flex:1}.article-row{padding-top:24px;padding-bottom:24px;margin-bottom:8px}.article-row .article-type{color:grey;letter-spacing:1px;text-transform:uppercase;font-family:sans-serif;font-size:12px;margin:0 0 8px}.article-row .article-title-link{text-decoration:none;color:#000;font-family:"Archivo Narrow",sans-serif;font-weight:700}.article-row .article-title-link:hover{text-decoration:underline}.article-row .article-title{margin-top:0;margin-bottom:20px}.article-row .article-excerpt{font-size:18px;line-height:1.8}.article-row .article-excerpt>*{margin-top:0;margin-bottom:16px}.article-row .article-read-more{color:#00f}.post .post-title{font-size:48px}.post .post-content{max-width:78ch;line-height:1.8;font-size:20px}.post .post-content>*{margin:0 0 32px}.post .post-content *+h2,.post .post-content *+h3,.post .post-content *+h4,.post .post-content *+h5,.post .post-content *+h6{margin-top:88px}.post .post-content pre{overflow-x:visible}.post .post-content pre.no-wrap{overflow-x:scroll}@media(max-width:1000px){.post .post-content pre.wp-block-code,.post .post-content pre.wp-block-preformatted{overflow-x:scroll}}.post .post-categories,.post .post-tags{margin-bottom:24px}.post .post-tags{max-width:100%;display:flex;flex-wrap:wrap;align-content:space-between}.post .post-tags a{font-family:"Archivo Narrow",sans-serif;font-weight:400;letter-spacing:1px;padding:6px 24px;margin-right:16px;margin-bottom:16px;text-decoration:none;background:#eaeaea;border-radius:15px;color:#000;font-size:16px}.post .post-tags a:hover{background-color:#15202b;color:#fff}.post .post-project-link{color:#fff;margin-bottom:24px;display:inline-block;padding:8px 24px;letter-spacing:1px;font-family:"Archivo Narrow",sans-serif;text-decoration:none;font-weight:700;text-transform:uppercase;background-color:#385bda;box-shadow:0 5px #0420ad;border-radius:4px}.post .post-project-link:hover{color:#fff;box-shadow:0 3px #0420ad;top:2px;position:relative}pre[class*=language-] span.token{background-color:transparent}.nuxt-content-highlight pre[class*=language-],pre[class*=language-]{white-space:pre-wrap;font-family:monospace;padding:20px;background-color:#000;color:#fff;font-size:16px;border-radius:5px;font-weight:400;text-shadow:none}.nuxt-content-highlight pre[class*=language-].no-wrap,pre[class*=language-].no-wrap{white-space:pre;overflow-x:visible}@media(max-width:1000px){.nuxt-content-highlight pre[class*=language-],.nuxt-content-highlight pre[class*=language-].wp-block-preformatted,pre[class*=language-],pre[class*=language-].wp-block-preformatted{white-space:pre}}code{font-family:monospace}@media(max-width:1000px){code{white-space:pre}}@media(max-width:1000px){.wp-block-code{overflow-x:scroll}}.wp-block-code.no-wrap code{white-space:pre}@media(max-width:1000px){.wp-block-code code{white-space:pre}}.page code[class*=language-],.page pre[class*=language-]{font-size:15px}.page code[class*=language-],.page code[class*=language-] span,.page pre[class*=language-],.page pre[class*=language-] span{font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace}figure{margin-top:0}figure img{max-width:100%;height:auto}figure figcaption{font-size:13px;min-width:300px}figure.aligncenter figcaption{text-align:center}footer{min-height:150px}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.default-layout[data-v-60df20fd]{margin-top:40px;margin-bottom:60px}.top-bar .site-header .header-link[data-v-40d14d74]{text-decoration:none;color:#000}.top-bar .site-header .header-description[data-v-40d14d74]{color:#8a8a8a;font-family:sans-serif;font-weight:400;font-size:18px}.top-bar .top-bar-nav[data-v-40d14d74]{border-bottom:1px solid #d0cfcf;list-style-type:none;padding:0 0 24px;display:flex;justify-content:flex-start;align-items:center;grid-column-gap:16px;-moz-column-gap:16px;column-gap:16px}.top-bar .top-bar-nav .navigation-link[data-v-40d14d74]{color:#00f}.dark .top-bar .site-header .header-link[data-v-40d14d74],.dark .top-bar .top-bar-nav .navigation-link[data-v-40d14d74]{color:#fff}.dark .article-slug .article-meta{color:#c1c5cb}.article-slug{margin-top:30px}.article-slug h2{font-size:60px;margin-bottom:4px}.article-slug .article-meta{font-family:"Archivo Narrow",sans-serif;margin-bottom:60px;font-size:18px;color:#525252}.article-slug .nuxt-content{line-height:1.8;font-size:20px;margin-bottom:60px}.article-slug .nuxt-content>*{margin:0 0 32px}.article-slug .nuxt-content *+h2,.article-slug .nuxt-content *+h3,.article-slug .nuxt-content *+h4,.article-slug .nuxt-content *+h5,.article-slug .nuxt-content *+h6{margin-top:88px}.article-slug .nuxt-content pre{overflow-x:visible;font-family:monospace}.article-slug .nuxt-content pre code,.article-slug .nuxt-content pre code span{font-family:monospace}.article-slug .nuxt-content .nuxt-content-highlight{background-color:rgba(38,38,38,.54);border-top-left-radius:5px;border-top-right-radius:5px}.article-slug .nuxt-content .nuxt-content-highlight span.filename{font-family:monospace;font-size:14px;margin-left:20px}.article-image[data-v-3be05b54]{margin-top:12px;margin-bottom:12px}.article-image img[data-v-3be05b54]{margin:0 auto;display:block}.article-image figcaption[data-v-3be05b54]{text-align:center;margin-top:12px}</style><link rel="preload" href="/_nuxt/static/1648826722/articles/discord-bot-development-embedded/state.js" as="script"><link rel="preload" href="/_nuxt/static/1648826722/articles/discord-bot-development-embedded/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1648826722/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="default-layout" data-v-60df20fd><div class="top-bar contain" data-v-40d14d74 data-v-60df20fd><header class="site-header" data-v-40d14d74><a href="/" class="header-link nuxt-link-active" data-v-40d14d74><h1 data-v-40d14d74>Brian Kelleher</h1></a> <a class="btn dark-btn" data-v-40d14d74>Toggle Dark Mode</a> <h1 class="header-description" data-v-40d14d74>
      Full-Stack Web Developer in Denver, CO
    </h1></header> <nav class="top-bar-nav contain" data-v-40d14d74><a href="/articles" class="nuxt-link-active" data-v-40d14d74>
      Articles
    </a> <a href="https://twitter.com/b_kelleher" data-v-40d14d74>Twitter</a></nav></div> <div class="article-slug contain" data-v-60df20fd><h2>Discord Bot Development - Embedded Messages</h2> <p class="article-meta">
    Last Updated: April 1, 2022
  </p> <div class="nuxt-content"><p>If you are looking for a quick intro to writing a Discord bot in JavaScript, I would head on over to <a href="/articles/creating-and-hosting-a-simple-discord-bot/">my intro tutorial</a>. In this tutorial, I’ll be discussing some advanced Discord bot features, including embedded messages and interfacing with external APIs to inform bot responses.</p>
<p>I will assume you have the following knowledge approaching this tutorial:</p>
<ul>
<li>an understanding of what the Discord platform is, and how to scaffold a simple bot for the platform (I explain this in a previous tutorial if you need a refresher)</li>
<li>NodeJS and JavaScript</li>
<li>having a test Discord server used to develop your bot</li>
<li>basic understanding a RESTful API</li>
</ul>
<p>I will cover:</p>
<ul>
<li>Creating an embedded message in Discord</li>
<li>Pulling information from a basic RESTful API to inform an embedded message</li>
</ul>
<p>Requirements to get started:</p>
<ul>
<li>NodeJS 14+ installed locally</li>
<li>Discord.com account and a test server equipped with your simple bot</li>
<li>Simple bot project on your local machine, referenced in the previous tutorial</li>
</ul>
<h3 id="registering-our-new-command"><a href="#registering-our-new-command" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Registering Our New Command</h3>
<p>In the previous tutorial, we covered sending basic responses back to a user. As this method is perfectly acceptable for many bot implementations, there are enhanced messages in Discord called ’embedded messages’ which can provide a slightly better response format, easily distinguishable from standard user messages.</p>
<p>To start, we will create a simple Weather.js class. We will extend the Command class that we created in a previous session so we can just focus on the fun part.</p>
<div class="nuxt-content-highlight"><span class="filename">commands/Weather.js</span><pre class="line-numbers language-js"><code><span class="token keyword">const</span> <span class="token maybe-class-name">Command</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./Command.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">MessageEmbed</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'discord.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> <span class="token maybe-class-name">Command</span> <span class="token punctuation">{</span>

    <span class="token comment">// Invoke the constructor which registers the command prefix.</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">'weather'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Invoked when a command matches.</span>
    <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">_message</span><span class="token punctuation">.</span><span class="token method function property-access">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Weather command.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// This should retrieve the message argument in the given message string</span>
    <span class="token function">getMessageArgument</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Parse the message string and return the argument at the index, split by space</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">_message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// console.log(this._message);</span>
            <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">_message</span><span class="token punctuation">.</span><span class="token property-access">content</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"Message argument is:"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword control-flow">return</span> a<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword control-flow">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div>
<p>Here we will setup the basics. This should give us a good starting point for the bot to simply recognize our command. Here I’ve also added a basic message argument parser. We could move this logic to our parent Command class, however not every message might parse the same. For now, we will keep it unique to the command.</p>
<p>To register our command, we go back to index.js. Let’s import our command and register it in our commands array:</p>
<div class="nuxt-content-highlight"><span class="filename">index.js</span><pre class="line-numbers language-js"><code><span class="token comment">// Import all necessary libraries, commands, and functions.</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Discord</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'discord.js'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Discord<span class="token punctuation">.</span>Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">TimeCommand</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./commands/Time.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">WeatherCommand</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./commands/Weather.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CLIENT_LOGIN_KEY</span> <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">CLIENT_LOGIN_KEY</span> <span class="token operator">||</span> <span class="token string">'Your-Dev-Bot-Token-Here'</span><span class="token punctuation">;</span>

<span class="token comment">// Our Digital Ocean health check.</span>
http<span class="token punctuation">.</span><span class="token method function property-access">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token string">'YourBotName Online.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Register all commands here.</span>
<span class="token keyword">let</span> commands <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">TimeCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">WeatherCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// When the bot is logged in and ready to go</span>
client<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Logged in as </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>client<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token property-access">tag</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// On message sent in discord</span>
client<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">msg</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// We want to avoid responding to ourselves.</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> msg<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">processing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token punctuation">.</span><span class="token property-access">content</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Search for the first command that matches the provided message.</span>
        <span class="token keyword">let</span> i <span class="token operator">=</span> commands<span class="token punctuation">.</span><span class="token method function property-access">findIndex</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token arrow operator">=></span> c<span class="token punctuation">.</span><span class="token method function property-access">matchesCommand</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>i <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            commands<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Perform the login, which initializes a websocket connection.</span>
client<span class="token punctuation">.</span><span class="token method function property-access">login</span><span class="token punctuation">(</span><span class="token constant">CLIENT_LOGIN_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Super easy, thanks to our previous work.</p>
<p>Going back to our Weather command file, let’s add some basic functionality to fetch our weather data. We will need a bit of setup before we are ready to tackle the code. First, we will install Axios, a popular HTTP request library for convenience, and register for access to a weather API.</p>
<p>To install axios, simply run:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-bash"><code><span class="token function">npm</span> i --save axios
</code></pre></div>
<p>For our weather API, you can certainly choose your own, but for the tutorial purposes I will be using the Open Weather service. It was very simple to create an account and register an API key through their website, which we will need for our API requests.</p>
<p>For starters, lets import axios add two functions to our Weather class to handle the HTTP request to the weather service, and to craft the URL to request. We are also going to include a MessageEmbed class from discord.js which will assist us later in message creation:</p>
<div class="nuxt-content-highlight"><span class="filename">commands/Weather.js</span><pre class="line-numbers language-js"><code><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"axios"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">MessageEmbed</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'discord.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span>

<span class="token comment">// Place this URL function inside the class.</span>
<span class="token function">url</span><span class="token punctuation">(</span><span class="token parameter"><span class="token dom variable">location</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token string">"https://api.openweathermap.org/data/2.5/weather"</span>
        <span class="token operator">+</span> <span class="token string">"?q="</span>
        <span class="token operator">+</span> <span class="token dom variable">location</span>
        <span class="token operator">+</span> <span class="token string">"&APPID="</span>
        <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">"&lt;Your API Key Here>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Place this getWeather function inside the class.</span>
<span class="token keyword">async</span> <span class="token function">getWeather</span><span class="token punctuation">(</span><span class="token parameter"><span class="token dom variable">location</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword control-flow">await</span> axios<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">url</span><span class="token punctuation">(</span><span class="token dom variable">location</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span> <span class="token string">"Error finding weather information."</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>NOTE: If you are intending to put this type of service into production, I would recommend moving your API key to an environment variable, verifying the location parameter, returning a reliable type from the getWeather command, etc.</p>
<h3 id="creating-an-embedded-discord-message"><a href="#creating-an-embedded-discord-message" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Creating an Embedded Discord Message</h3>
<p>First, lets set two helper functions for ourselves. Based on our weather API response, I’ve decided I want to change the color of the discord embed message to match, and be able to present the degrees in Fahrenheit rather than Kelvin.</p>
<p>Adding to our class methods:</p>
<div class="nuxt-content-highlight"><span class="filename">commands/Weather.js</span><pre class="line-numbers language-js"><code><span class="token comment">// Capable of translating a kelvin numeric value to Fahrenheit</span>
<span class="token function">kelvinToF</span><span class="token punctuation">(</span> <span class="token parameter">kelvin</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>kelvin <span class="token operator">-</span> <span class="token number">273.15</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Returns the correct color for the discord embed.</span>
<span class="token function">getEmbedColorForType</span><span class="token punctuation">(</span> <span class="token parameter">type</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> type_string <span class="token operator">=</span> type<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span> <span class="token keyword">typeof</span> type_string <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">||</span> type_string <span class="token keyword">instanceof</span> <span class="token class-name">String</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        type_string <span class="token operator">=</span> type_string<span class="token punctuation">.</span><span class="token method function property-access">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">switch</span><span class="token punctuation">(</span>type_string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">"snow"</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> <span class="token string">"WHITE"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"sun"</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> <span class="token string">"YELLOW"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"clear"</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> <span class="token string">"YELLOW"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"clouds"</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> <span class="token string">"DARK_GREY"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"mist"</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> <span class="token string">"GREYPLE"</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"rain"</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> <span class="token string">"DARK_AQUA"</span><span class="token punctuation">;</span>
        <span class="token keyword module">default</span><span class="token operator">:</span>
            <span class="token keyword control-flow">return</span> <span class="token string">"AQUA"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Now, let’s edit our handler function.</p>
<p>Replace the contents of the handler function with the following, and I will explain:</p>
<div class="nuxt-content-highlight"><span class="filename">commands/Weather.js</span><pre class="line-numbers language-js"><code><span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Set a couple of starter variables, and pull in message arguments/set defaults.</span>
    <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> arg <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">getMessageArgument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> loc <span class="token operator">=</span> <span class="token string">'Denver'</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span> arg <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        loc <span class="token operator">=</span> arg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Initialize the message embed class.</span>
    <span class="token keyword">const</span> embed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageEmbed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Set a title for the Query.</span>
    embed<span class="token punctuation">.</span><span class="token method function property-access">setTitle</span><span class="token punctuation">(</span><span class="token string">"Weather Search: "</span> <span class="token operator">+</span> loc<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Set a default color for the embed.</span>
    embed<span class="token punctuation">.</span><span class="token method function property-access">setColor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">getEmbedColorForType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Make API request for the weather.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">getWeather</span><span class="token punctuation">(</span>loc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// Set the body of the message embed.</span>
        embed<span class="token punctuation">.</span><span class="token method function property-access">setDescription</span><span class="token punctuation">(</span><span class="token string">"Weather information for "</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">+</span> <span class="token string">" (Country: "</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">sys</span><span class="token punctuation">.</span><span class="token property-access">country</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Set metadata fields for the message embed.</span>
        embed<span class="token punctuation">.</span><span class="token method function property-access">addField</span><span class="token punctuation">(</span><span class="token string">"Current Conditions"</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">weather</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">main</span> <span class="token operator">+</span> <span class="token string">" ("</span> <span class="token operator">+</span> resp<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">weather</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">description</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        embed<span class="token punctuation">.</span><span class="token method function property-access">addField</span><span class="token punctuation">(</span><span class="token string">"Current Temperature"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span><span class="token method function property-access">kelvinToF</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">main</span><span class="token punctuation">.</span><span class="token property-access">temp</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" °F"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span> resp<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">snow</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            embed<span class="token punctuation">.</span><span class="token method function property-access">addField</span><span class="token punctuation">(</span><span class="token string">"Precipitation:"</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">snow</span><span class="token punctuation">[</span><span class="token string">'1h'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">' mm/hr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Override the color set.</span>
        embed<span class="token punctuation">.</span><span class="token method function property-access">setColor</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token method function property-access">getEmbedColorForType</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">weather</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">main</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Send the embed to discord.</span>
        self<span class="token punctuation">.</span><span class="token property-access">_message</span><span class="token punctuation">.</span><span class="token property-access">channel</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>embed<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'error sending data to discord'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token property-access">_message</span><span class="token punctuation">.</span><span class="token property-access">channel</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">"Error retrieving weather information.  Please use only a city and country code, no state codes."</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'error sending message to discord'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>I’ve commented each line, but essentially we initialize a MessageEmbed object, we set a bunch of fields and properties by default, we make a weather request, and based on the result we either complete our embedded message with weather data, or show an error.</p>
<p>It’s that simple! We should be ready to test. Start up our server with node index.js, and test the command in your server! You should see the following:</p>
<figure class="article-image" data-v-3be05b54><img src="/_nuxt/img/discord-weather-embed-message.a497b0d.png" alt="Embedded Message output for a basic weather command." style="max-width:450px" data-v-3be05b54> <figcaption data-v-3be05b54>Embedded Message output for a basic weather command.</figcaption></figure>
<p>Success!</p>
<h3 id="additional-capabilities-and-resources"><a href="#additional-capabilities-and-resources" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Additional Capabilities and Resources</h3>
<p>Now, embedded messages are really powerful. They can display a lot of information in a user friendly format, link to resources, and even attach files. I highly recommend browsing the discord.js API documentation, <a href="https://discord.js.org/#/docs/main/stable/class/MessageEmbed" rel="nofollow noopener noreferrer" target="_blank">particularly on MessageEmbed</a>, to see all of the available methods and properties to customize a message. In another side project I was able to use these advanced features to flush out embedded messages to be rather useful:</p>
<figure class="article-image" data-v-3be05b54><img src="/_nuxt/img/discord-embed-stock.f72061e.png" alt="Embedded stock data." style="max-width:650px" data-v-3be05b54> <figcaption data-v-3be05b54>Embedded stock data.</figcaption></figure>
<figure class="article-image" data-v-3be05b54><img src="/_nuxt/img/discord-embed-stock-graph.0e78575.png" alt="Embedded stock graph." style="max-width:650px" data-v-3be05b54> <figcaption data-v-3be05b54>Embedded stock graph.</figcaption></figure>
<p>If you are looking for a place to get started with creating embedded media on the fly such as the graph above, I can recommend looking at a project such as the <a href="https://www.npmjs.com/package/chartjs-node-canvas" rel="nofollow noopener noreferrer" target="_blank">chartjs-node-canvas project</a>. Discord’s powerful API and messaging capabilities matched with powerful Node tools for calculations and media creation can result in some really fun and useful possibilities.</p>
<p>To let me know your thoughts or questions on a project like this – just <a href="https://twitter.com/b_kelleher" rel="nofollow noopener noreferrer" target="_blank">tweet me</a>!</p></div></div></div></div></div><script defer src="/_nuxt/static/1648826722/articles/discord-bot-development-embedded/state.js"></script><script src="/_nuxt/d742747.js" defer></script><script src="/_nuxt/381879a.js" defer></script><script src="/_nuxt/4e74c3e.js" defer></script><script src="/_nuxt/900b283.js" defer></script><script src="/_nuxt/87eb4cc.js" defer></script><script src="/_nuxt/eb224da.js" defer></script>
  </body>
</html>
